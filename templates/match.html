{% extends "base.html" %}
{% block title %}{{ home }} vs {{ away }} · AH{% endblock %}
{% block content %}
<h1 class="h4">{{ home }} vs {{ away }}</h1>
<p class="text-muted">{{ league.name }} · {{ match.kickoff_utc.strftime('%Y-%m-%d %H:%M UTC') }}</p>

<div id="prob-pie" class="my-3"></div>
<script>
  const probs = [
    { label: "Home cover", v: {{ predictions[0].p_home_cover if predictions|length else 0 }} },
    { label: "Away cover", v: {{ predictions[0].p_away_cover if predictions|length else 0 }} }
  ];
  Plotly.newPlot('prob-pie', [{
    labels: probs.map(p => p.label),
    values: probs.map(p => p.v),
    type: 'pie'
  }], { title: 'Cover probabilities' });
</script>

<table class="table table-sm">
  <thead><tr><th>Model</th><th>AH (home)</th><th>P(home)</th><th>P(away)</th><th>Fair (H)</th><th>Fair (A)</th><th>Edge (H)</th><th>Edge (A)</th></tr></thead>
  <tbody>
    {% for p in predictions %}
    <tr>
      <td>{{ p.model }}</td>
      <td>{{ '%+.2f'|format(p.ah_line) }}</td>
      <td>{{ '%.1f%%'|format(p.p_home_cover*100) }}</td>
      <td>{{ '%.1f%%'|format(p.p_away_cover*100) }}</td>
      <td>{{ '%.2f'|format(p.fair_home_decimal) }}</td>
      <td>{{ '%.2f'|format(p.fair_away_decimal) }}</td>
      <td class="{% if p.edge_home>0 %}text-success{% elif p.edge_home<0 %}text-danger{% endif %}">{{ '%.2f%%'|format(p.edge_home*100) }}</td>
      <td class="{% if p.edge_away>0 %}text-success{% elif p.edge_away<0 %}text-danger{% endif %}">{{ '%.2f%%'|format(p.edge_away*100) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
